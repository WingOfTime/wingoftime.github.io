[{"content":"前言 忙于工作，一周后的第二篇来了，在上一篇中我们搭建好了博客，并且将 public 下的文件上传到了 github pages 并成功显示。但是为了源码安全，源码和构建产物是分开两个仓库的，修改完后需要手动构建并手动推送，稍显麻烦。\n那么这一篇呢，我们就让源码在发布的时候自动构建并推送到 github.io 这个仓库上。\n自动化构建 github actions 是 github 提供的免费 CI/CD 功能，可以在代码提交后自动构建自动推送。\n生成 personal_token 因为是分开两个仓库的，所以需要提供推送的权限，我们点击 github 头像位置，下拉栏中选择 Settings -\u0026gt; Developer Settings -\u0026gt; Personal access tokens -\u0026gt; Tokens(classic)\n点击生成 token，Expiration 选择 no expiration, scopes 选择 repo、workflow 权限即可，新增后记得复制保存。\n添加 personal_token 在 blog 的仓库中添加 token，注意是源码仓库。blog -\u0026gt; Settings -\u0026gt; Secrets and variables -\u0026gt; Actions 的 Secrets 中点击 New repository secret，把之前的 personal_token 贴上，名字就叫 personal_token，需要跟后面的 yml 配置文件保持一致。\n增加 deploy yml 在 blog 的根目录下新增 .github/workflows 目录，在该目录下新增 blog-deploy.yml 文件，示例配置如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 name: deploy on: push: branches: - main workflow_dispatch: jobs: build: runs-on: ubuntu-latest steps: - name: Checkout uses: actions/checkout@v3 with: submodules: true fetch-depth: 0 ref: main # 这里选择你触发部署的分支！默认是 master - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: \u0026#34;latest\u0026#34; extended: true # 用 stack 主题需要加这个配置 - name: Build Web run: hugo --minify - name: Deploy Web uses: peaceiris/actions-gh-pages@v3 with: PERSONAL_TOKEN: ${{ secrets.PERSONAL_TOKEN }} EXTERNAL_REPOSITORY: wingoftime/wingoftime.github.io # 改成你的仓库 PUBLISH_BRANCH: main PUBLISH_DIR: ./public commit_message: ${{ github.event.head_commit.message }} 修改代码并推送 以上的设置都完成的话，修改博客代码后并推送，就可以在 github 网页上看到工作流了，示例如下：\n总结 得益于大佬们写的第三方包，这让整个发布代码变得非常精简，拉代码、安装、构建、发布。到这里估计就差不多了，至于自定义域名，首先要有域名注册及备案，其次跟着 github page 的文档来即可，总体比较简单，就不在这里啰嗦了。\n","date":"2023-04-23T00:00:00Z","image":"https://www.wingoftime.cn/p/setup-blog-second/github_action_hu2f1e02e515e351c311ec896043222feb_94638_120x120_fill_q75_box_smart1.jpg","permalink":"https://www.wingoftime.cn/p/setup-blog-second/","title":"搭建个人博客系列（二）：hugo 使用 github actions 保存源码和自动化构建"},{"content":"前言 在搭建本博客的过程中，参考了很多人的技术文档以及官方文档。特别在这里记录本博客的搭建过程，给后来者提供便利，本文默认读者具备基础的命令行操作。\ngithub pages 是一个静态网站托管服务，免费版足够个人博客使用，无需服务器成本。\nhugo 是一个静态网站生成器，帮你快速生成网站。\n搭建博客 安装 hugo 打开终端 terminal，输入安装指令，此处以 macos 举例，其他可参照 hugo 的 官方指南 进行安装。注意本博客要求的 hugo 版本需要带有 extended。 1 brew install hugo 安装完成后，输入以下命令来确认版本。 1 hugo version 新建网站并挑选主题 cd 到你喜欢的目录下创建网站目录，创建完后就可以用你喜欢的 ide 打开该目录了，作者用的 vscode 1 hugo new site blog 如果没接触过 git 和 github 的话，可以参照这个，配置好 git，廖雪峰的 git 教程\n在 Hugo Themes 中挑选你喜欢的主题，本博客采用 hugo-theme-stack 搭建，以下示例均为该主题为例，\n1 2 3 cd blog git init git submodule add https://github.com/CaiJimmy/hugo-theme-stack/ themes/hugo-theme-stack 可以看到 themes 目录下出现了主题，将 hugo-theme-stack/exampleSite 目录下的文件拷贝至根目录，就可以运行 demo 了 1 2 cp themes/hugo-theme-stack/exampleSite/* . hugo server 注意 config.yaml 里面有几项需要修改一下。 1 2 3 4 5 6 7 baseurl: https://\u0026lt;yourname\u0026gt;.github.io # \u0026lt;yourname\u0026gt; 改成你的 github 用户名 enableInlineShortcodes: true # 这条原来里面没有，需要新增一下，没有的话，例子里面的 css.inline 不会生效 markup: goldmark: renderer: ## Set to true if you have HTML content inside Markdown unsafe: true # 建议开启 下面就可以修改 content/post 下面文章来自定义你的文章了，想自定义主题相关设置可以参照 hugo-theme-stack。 构建网站并上传至 github 构建并进入 public 库初始化 git。 1 2 3 hugo cd public git init 在 github 上添加远程库并关联，如图所示，一定要是这个地址。\u0026lt;yourname\u0026gt;.github.io， 1 2 3 4 git remote add origin git@github.com:\u0026lt;yourname\u0026gt;/\u0026lt;yourname\u0026gt;.github.io.git git add . git commit -m \u0026#34;blog init\u0026#34; git push -u origin master 在这里已经走到了最后一步，可以打开 http://\u0026lt;yourname\u0026gt;.github.io 看看有没有生效啦。后面每次修改后构建，并推送 git 即可。更多关于 pages 的设置在 github repository -\u0026gt; settings -\u0026gt; pages 里查看，包括分支选择，自定义域名，https 等。 总结 再梳理一下后续博客发布的整个步骤：\n新建文章并编辑。 hugo server 本地预览。 hugo 构建网站。 利用 git 提交修改。 要注意的一点是，为了源码安全，这里是在 public 下面提交 git，不要把整个 blog 目录都提交上去了， blog 可以单独生成一个私人仓库管理，一切为了安全。自动化构建的话，会在下一篇中进行讲解。\n","date":"2023-04-12T00:00:00Z","image":"https://www.wingoftime.cn/p/setup-blog-first/hugo_huc45e8b6a1dd78d1984839a3faf61f91b_107630_120x120_fill_q75_box_smart1.jpg","permalink":"https://www.wingoftime.cn/p/setup-blog-first/","title":"搭建个人博客系列（一）：利用 github pages + hugo 免费搭建专属博客"}]